var xfetch=function(e){"use strict";const t=e=>[...e.entries()].reduce(((e,[t,n])=>(e[t]=n,e)),{});return e.fetchMiddleware=function({namespace:e=globalThis||window,fetch:n=e.fetch}={}){if(null==e&&(e=globalThis||window),"object"!=typeof e)throw new Error("[xfetch-middleware] - `namespace` should be an object");if("function"!=typeof n)throw new Error("[xfetch-middleware] - `fetch` should be a function");if("function"==typeof n.onRequest)return n.stopIntercepting;const o="fetch",r=[];async function s(...e){const o=[];let s=new Request(...e),u=null,i=null,c=null,f=null;for(const e of r){let r=await e({request:s,fetch:n,get url(){return c||(e=s.url,c=new URL(e));var e},get headers(){return f||(f=t(s.headers))}});r&&(r.request instanceof Request&&(s=r.request),r.response instanceof Response&&(u=r.response),"function"==typeof r.listen&&o.push(r.listen),"string"==typeof r.as&&(i=r.as))}async function a(e){let t=i&&"function"==typeof e[i];return o.forEach((n=>{const o=e.clone();t?o[i]().then(n):n(o)})),e}return u?a(u):n(s).then(a)}function u(){e.fetch=n}return Object.defineProperty(s,"name",{value:o,configurable:!0}),e.fetch=s,s.stopIntercepting=u,s.onRequest=function(e){if("function"!=typeof e)throw new Error("[onRequest] - Argument must be a function");return r.find((t=>t===e))||function(e){r.push(e)}(e),()=>{}},u},e.xhrMiddleware=function({namespace:e=globalThis||window}={}){if(null==e&&(e=globalThis||window),"object"!=typeof e)throw new Error("[xfetch-middleware] - `namespace` should be an object");const n=e.XMLHttpRequest;if("function"!=typeof n)throw new Error("[xfetch-middleware] - `XMLHttpRequest` should be a function.");const o=[];function r(){let e,r,s,u,i,c,f,a,l=new n,d=this,p=[],h=[];this.onreadystatechange=null,l.onreadystatechange=function(){if(s&&4==this.readyState){let e=l.responseType;try{d.response=a||(a=((e,t)=>e.reduce(((e,t)=>t(e)),t))(p,l.response)),""!==e&&"text"!==e||(d.responseText=l.responseText),h.forEach((e=>e.call(d,d)))}catch(e){console.warn("Error in proxied XMLHTTP",e.message)}}if(d.onreadystatechange)return d.onreadystatechange()},["status","statusText","readyState","responseXML","upload"].forEach((function(e){Object.defineProperty(d,e,{get:function(){return l[e]}})})),["ontimeout, timeout","withCredentials","onload","onerror","onprogress","responseType"].forEach((function(e){Object.defineProperty(d,e,{get:function(){return l[e]},set:function(t){"onload"===e&&"function"==typeof t&&(t=t.bind(d)),l[e]=t}})})),["addEventListener","abort","getAllkeyResponseHeaders","getResponseHeader","overrideMimeType"].forEach((function(e){Object.defineProperty(d,e,{value:function(){return l[e].apply(l,arguments)}})}));let w=new Headers;d.setRequestHeader=function(e,t){w.append(e,t)},d.open=function(t,n,o,c,f){e=t,r=new URL((e=>{if(/^https?/.test(e))return e;let t=window.location.protocol+"//"+window.location.host;return"/"===e[0]?t+e:t+window.location.pathname+"/"+e})(n)),s=!1!==o,u=c,i=f,l.open(e,r,s,u,i)},d.send=async function(n){if(c=n,s){for(const n of o){let o=await n({method:e,url:r,body:c,get headers(){return f||(f=t(w))}});o&&(o.method&&(e=o.method),o.url&&(r=o.url.href||o.url),void 0!==o.body&&(c=o.body),o.headers instanceof Headers&&(w=o.headers),"function"==typeof o.transformResponse&&p.push(o.transformResponse),"function"==typeof o.listen&&h.push(o.listen))}l.open(e,r,s,u,i);for(const e in w.entries())l.setRequestHeader(e[0],e[1]);l.send(c)}}}function s(){e.XMLHttpRequest=n}return Object.defineProperty(r,"name",{value:"XMLHttpRequest",configurable:!0}),e.XMLHttpRequest=r,r.stopIntercepting=s,r.onRequest=function(e){if("function"!=typeof e)throw new Error("[onRequest] - Argument must be a function");return o.find((t=>t===e))||function(e){o.push(e)}(e),()=>{}},s},Object.defineProperty(e,"__esModule",{value:!0}),e}({});